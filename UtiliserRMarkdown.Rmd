---
title: "Utiliser R Markdown pour créer des documents dynamiques"
date: "`r format(Sys.time(), '%d %B %Y')`"
author: par Kevin Cazelles
lang: fr
abstract: Le package `rmarkdown` permet de créer des documents dynamiques qui intègrent des morceaux de code R et ce qu'ils génèrent (dont figures et tableaux). Ce document est une introduction à R Markdown qui passe en revue différents aspects techniques nécessaires à la bonne compréhension et l'utilisation du package `rmarkdown`. Le code source de ce document est en lui-même un exemple d'application du package. Le lecteur trouvera également un ensemble de références disponibles en ligne pour aller plus loin.
fontfamily: fourier
linestretch: 1
fontsize: 10pt #11pt ou 12pt
lof: yes
# urlcolor: magenta
output:
    html_document:
        toc: yes
        toc_float: yes
        # css: ./aux/designR.css
        highlight: default
        #“tango”, “pygments”, “kate”, “monochrome”, “espresso”, “zenburn”, “haddock”
        theme: flatly
        # ou “default”, “cerulean”, “journal”, “readable”, “spacelab”, “united”, “cosmo”
        include:
            after_body: aux/footer.html
    pdf_document:
        highlight: tango
        toc: yes
        toc_depth: 3
        fig_caption: yes
        keep_tex: yes
        latex_engine: pdflatex #xelatex
        number_section: yes
        includes:
            before_body: aux/license.tex
        # template: ./aux/kev_latex.tex
    word_document:
        #toc: yes
        fig_caption: yes
        highlight: pygments
    md_document:
        variant: markdown_strict
bibliography: aux/mybiblio.bib
#csl: ./aux/nature.csl
csl: aux/journal-of-theoretical-biology.csl
header-includes:
    - \usepackage{fancyhdr}
    - \pagestyle{fancy}
    - \fancyfoot[CO,CE]{Documents dynamiques avec R Markdown}
    - \fancyfoot[R]{\thepage}
---


# Avant-propos

Ce document est une introduction à R Markdown conçu pour répondre aux objectifs suivants:

1. comprendre ce qu'est R Markdown;
2. comprendre les liens entre R, Markdown et Pandoc;
3. apprendre la syntaxe Pandoc Markdown;
4. apprendre à créer des documents dynamiques avec le package `rmarkdown`.

Ce document a lui-même été édité avec R Markdown et peut-être converti en une
page internet (au format HTML, `.html`), au format Word (`.docx`) ou encore en
document portable (`.pdf`). Bien que dans "R Markdown", il y ait "R" et
"Markdown", ce document n'est pas une introduction à R
(<http://www.r-project.org>). Le contenu est accessible aux utilisateurs
débutants et pour les lecteurs intéressés qui ne connaissent pas encore R, une
courte introduction à R est nécessaire. Ils pourront consulter l'une des
différentes introductions disponibles sur le site du CRAN:
<https://cran.r-project.org/other-docs.html>.

Ce document est déployé automatiquement par GitHub Actions (voir
<https://github.com/KevCaz/Rmarkdowndocfr/actions>), lors de la dernière
compilation, la version `r packageVersion("rmarkdown")` du package `rmarkdown`
a été utilisée. De plus amples informations relatives à l'environnement dans
lequel le document a été compilé sont indiquées ci-dessous.


<details>
```{r sesinfo}
sessionInfo()
rmarkdown::pandoc_version()
```
</details>



# Introduction

Dans de nombreux milieux professionnels, à des fins de communication diverses,
sont produits régulièrement des documents intégrant des analyses de données
(tableaux, figures, tests statistiques, etc.). Pour créer de tels documents, il
faut être en mesure de manipuler des données les analyser et créer des figures
pour les intégrer dans le document final. [R](http://www.r-project.org) est un
langage de programmation qui répond à ces besoins avec un grand nombre de
package qui permettent de manipuler et traiter un spectre très large de données
et de les visualiser efficacement. Ce langage offre également la possibilité
d'intégrer code et les produits du code (résultats de tests, tableaux, figures,
etc.) directement dans un document qui est alors qualifié de dynamique. Le
package le plus utilisé pour créer des documents dynamiques est la package
`rmarkdown` l'intégration de R dans un document écrit avec Markdown et qui peut
être converti en de nombreux formats de document (dont PDF, word, HTML). C'est
ce package qui est l'objet de ce document, bien qu'il nous faudra en mentionner
d'autre ainsi que d'autres langages et outils pour comprendre ce package, en
commençant par Markdown.

Écrire un document en Markdown, quésaco? Markdown est un langage de balisage
léger, c'est-à-dire un langage dans lequel on peut utiliser des ensembles de
caractères spécifiques (des balises) pour délimiter une zone de texte pour
laquelle un formatage associé (e.g. **text en gras**) est appliqué. Markdown est
aujourd'hui très répandu sur Internet, à tel point que vous pourriez une des
différentes syntaxes existantes sans me le savoir. Sans être exhaustif, il est
utile de donner un peu plus de détails sur ce point pour bien comprendre ce quel
Markdown on utilise avec R Markdown. La syntaxe originale de Markdown est le
fruit du travail de John Gruber[^wiki_gruber], programmeur, bloggeur et
baladodiffuseur de Philadelphie en collaboration avec Aaron Swartz (lui même
connu pour avoir participer a la création de Creative Commons et son tragique
destin qui fut l'objet d'un film). Sur le site de John Gruber, "daringfireball",
Markdown est décrit depuis décembre 2004 et on peut même y télécharger la
version 1.0.1 (voir <http://daringfireball.net/projects/markdown>). L'idée de
départ est simple et élégante&nbsp;: produire un langage léger qui simplifie les
balises HTML (utilisé par tout les sites Internet). L'idée n'est pas tant de
remplacer le HTML mais plutôt d'en augmenter l'efficacité d'écriture et de fait,
il est beaucoup plus rapide d'écrire en Markdown qui couvre les opérations de
formatage les plus courantes (listes, hyperliens, etc.). Notons qu'il existe
d'autres langages qui répondent aux me objectif, par example
ReStructuredText[^wiki_rst].


Après la publication de Markdown, John Gruber a cessé de travailler sur
Markdown[^blog_badparent] et d'autres développeurs, sans doute séduits par le
langage, ont proposé différentes additions syntaxiques. Il s'agissait surtout de
lever certaines limitations tout en préservant l'esprit d'origine. Ci-dessous,
en voici une liste non exhaustive de différentes variantes Markdown:

 - [GitHub Flavored Markdown (GFM)](https://help.github.com/articles/github-flavored-markdown/)
 - [Kramdown](http://kramdown.gettalong.org/syntax.HTML#math-blocks)
 - [Markdown Extra](https://michelf.ca/projects/php-markdown/extra/)
 - [Multi Markdow](https://github.com/fletcher/MultiMarkdown/wiki/MultiMarkdown-Syntax-Guide#math-support)
 - [Pandoc Markdown](http://pandoc.org/README.HTML#pandocs-markdown)

Fort heureusement, depuis 2014, CommonMark (<https://commonmark.org/>) propose
une spécification (norme technique) pour Markdown de plus en plus
utilisée[^goldmark], ce qui signifie qu'en allant d'un outil à l'autre qui
utilise cette spécification, il n'y a pas de questions à se poser quant à savoir
ce qui marche ou non en terme de syntaxe (un problème parfois frustrant quand on
utilise plusieurs outils qui utilisent différentes syntaxes Markdown), il
suffit de se reporter à la spécification!


Il est important de souligner que R Markdown (voir
<http://rmarkdown.rstudio.com>)[^1] utilise [la variante Markdown de
Pandoc](https://rmarkdown.rstudio.com/lesson-8.html)[^2]. Une précision relative
à Pandoc (<http://www.pandoc.org>) s'impose: il s'agit, comme l'indique le site
internet, d'un "convertisseur de document universel", en une ligne de commande
Pandoc convertit un document dans un format donné en un document d'un autre
format. Par exemple, Pandoc permet de passer d'un fichier `.tex` (LaTeX) à un
fichier `.docx` (Word)! La variante Markdown de Pandoc a été pensé pour rester
fidèle à l'esprit originel de Markdown tout en incluant davantage d'éléments de
document communs différent format de documents[^pmd]. Pour rendre le document
dynamique, R Markdown ajoute notamment les fonctionnalités de l'excellent
package [`knitr`](http://cran.r-project.org/web/packages/knitr/index.html) qui
intègre du code R et ce qu'il produit. Le document dynamique en question pourra
être converti dans un grand nombre de format grâce à l'utilisation de
[Pandoc](http://www.pandoc.org/installing.html). Les intérêts de R Markdown sont
nombreux :

1. utiliser une syntaxe épurée pour distinguer la mise en page, le texte, le formatage du texte et le code R,
2. utiliser les fonctionnalités du package `knitr` pour créer morceaux de codes, tableaux et figures dynamiquement,
3. utiliser le format de sérialisation YAML pour personnaliser la mise en page des documents produits grâce à la fonction `render()`, elle-même appelée en quelques clics avec [RStudio](http://www.rstudio.com),
4. obtenir ainsi un document avec un contenu R dynamique en différents formats dont HTML (fichier `.html`), PDF (`.pdf`) et Word (`.docx`).

Il existe une documentation abondante relative à R Markdown, malheureusement
presque exclusivement écrite en anglais. Pour les lecteurs capables de lire la
la langue de Shakespeare, je recommande [le site officiel de R
Markdown](http://rmarkdown.rstudio.com) sur lequel vous trouverez, entre autres:

1. un condensé d'utilisation sous forme de *Cheat Sheet*, voir <http://www.rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf>;

2. un guide de référence disponible sur le site de RStudio <http://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf>.

Il y a également sur le site <https://bookdown.org> :

1. un livre en anglais très complet sur le sujet, par l'un des grands architectes de R Markdown, voir <https://bookdown.org/yihui/rmarkdown/>;

2. [un livre d'astuces (*cook book*)](https://bookdown.org/yihui/rmarkdown-cookbook/)  en cours d'écriture.

Une section complète du site de l'auteur principal de `knitr`,
<http://yihui.name/knitr/>, permet de bien comprendre l'intégration des morceaux
de code et des résultats de ce code, contenu qui fait l'objet d'un livre de ce
même auteur [@xie_dynamic_2017]. Je tiens également à signaler la [présentation
de Mansun Kuo sur Rpubs](http://rpubs.com/mansun_kuo/24330). Pour apprendre la
syntaxe Pandoc Markdown, vous pouvez vous reportez à la très complète page
internet écrite en français par Jean-Daniel Bonjour,
<http://enacit1.epfl.ch/markdown-pandoc>.

La syntaxe [Pandoc
Markdown](http://rmarkdown.rstudio.com/authoring_pandoc_markdown.html) est, à
mon sens, très complète, mais elle ne permet pas une personnalisation totale de
la mise en page de votre document. Il existe des moyens simples pour aller plus
loin avec R Markdown, détaillé dans le livre d'astuce mentionné ci-dessus. Si
toutefois vous souhaitez aller encore plus loin dans la mise en forme de votre
document, vous pouvez utiliser une des trois approches suggérez ci-dessous.
Néanmoins, avant d'envisager l'un de ces recours, il est très important de se
demander si cette personnalisation est nécessaire.

1. vous pouvez travailler sur le document dans le format qui vous intéresse après l'avoir générer, c'est une solution qui a une limite évident: à chaque fois que le document sera compilé, les modifications post-compilation seront perdues,
2. vous pouvez utiliser un *template* personnel[^template], un fichier qui gère partie la mise en forme de votre document) associé à votre document,
3. vous pouvez toujours composé en un langage donné, p. ex. [HTML](http://www.w3.org/html/) ou [Latex](http://www.latex-project.org), mais les commandes non valides pour un format donné, seront ignorées.


<!-- Pourrait faire l'objet de development future -->

Avant de rentrer dans le vif du sujet, je souhaiterais insister sur le fait que
cette introduction est axée sur la création de document en format Word, PDF et
HTML pour de nombreux usages (rapport, article, etc.), mais que les possibilités
offertes par `rmarkdown` sont plus vastes (voir le site dédié
<http://rmarkdown.rstudio.com>), entre autres

- pour les documents&nbsp;:
    - [PDF](https://en.wikipedia.org/wiki/Portable_Document_Format)
    - [HTML](http://rmarkdown.rstudio.com/html_document_format.html)
    - [Word](http://rmarkdown.rstudio.com/word_document_format.html)
    - [Tufte handout (Pdf)](http://rmarkdown.rstudio.com/tufte_handout_format.html)
    - [Package Vignette (Html)](http://rmarkdown.rstudio.com/package_vignette_format.html)
- pour les présentations&nbsp;:
    - [Beamer](http://rmarkdown.rstudio.com/beamer_presentation_format.html)
    - [ioslide](http://rmarkdown.rstudio.com/ioslides_presentation_format.html)
    - [Slidy](http://rmarkdown.rstudio.com/slidy_presentation_format.html)

De plus, il existe des packages qui se basent sur `rmarkdown` et en étendent les
applications. Par exemple, `blogdown` vous permet d'écrire des postes de blogue
avec R Markdown dans un site permet généré par Hugo (<https://gohugo.io/>).  De
me, grâce à bookdown] (<https://bookdown.org/yihui/bookdown/>), vous pouvez
créer de long documents HTML structuré comme un
[Gitbook](https://www.gitbook.com). Anisi, les fonctionnalités décrites dans ce
document permettent d'utiliser une très grande variété de médias pour partager
les fruits de votre labeur.

<!-- Cette
possibilité offerte depuis très longtemps avec la fonction `Sweave()` (package
de base `utils`) qui permet de remplacer du code R par son rendu. Mais la
véritable force vient des travaux de Yihui Xie avec le package
[`knitr`](http://cran.r-project.org/web/packages/knitr/index.html) (voir
<https://yihui.org/knitr/>), qui utilise cette fonctionnalité, permet de
produire des fichiers LaTeX intégrant du code R et des figures. Le package
[`rmarkdown`](https://rmarkdown.rstudio.com/) développé par RStudio est un
package R très populaire qui a rendu la création de documents dynamiques avec R
très efficace. -->








# Utiliser un fichier R Markdown

## Organisation générale

Un fichier R Markdown (dont l’extension est `.rmd` ou `.Rmd`), c'est :

1. un document de texte plein qui utilise la variante syntaxique Pandoc de Markdown;

2. des blocs de code particuliers qui, en plus de pouvoir être utilisé pour présenter du code, le code va pouvoir être exécuter et le résultat du code va pouvoir être intégré dans le document. Ces blocs commencent et finissent trois accents graves (*backtick* ou *backquote* en anglais): \` et les trois accents graves ouvrant le bloc sont suivis d'une accolade qui commence par r ou R, par exemple


    ````markdown
    `r ''````{R name, option1, option2}
    # code R à exécuter
    ```
    ````

    ou encore

    ````markdown
    `r ''````{r option1}
    # code R à exécuter
    ```
    ````

3. enfin, un *Front Matter*[^notrad] YAML optionnel (au début du fichier, dans un bloc de trois tirets&nbsp;: \-\-\-) qui permet de donner des indications sur le ou les documents à générer.

Au début, il peut-être un peu difficile de se retrouver un tel fichier car on y
croise différents langages, notamment

1. un langage de programmation pour les analyses, R;
2. un langage de balisage pour l'écriture du document, Markdown;
3. un langage de sérialisation de données pour spécifier les sorties du documents, YAML.

On peut ajouter qu'avec la variante syntaxique Pandoc de Markdown les symboles
mathématiques TeX[^wiki_TeX] sont utilisés pour rendre facile l'écriture, entre
autres, des équations[^pm_math], en un sens c'est un quatrième langage à
connaître!



## Créer un fichier R Markdown

Créer un fichier R Markdown, c'est simplement créer un fichier dont l'extension
est `.Rmd` ou `.rmd`, ce qui peut être vais avec n'importe quelle éditeur de
texte, ou de code, ou même en ligne de commande. Par example, étant moi-même
utilisateur du terminal et travaillant dans un environment Linux, j'entre dans
ce dernier la commande:

```shell
$ echo "---\nauthor: Kevin Cazelles\n---" > mondoc.Rmd
```

et le fichier est créé! Pour les utilisateurs de R Studio, cela peut se faire en
2 clics, comme illustré sur les figures qui suivent. L’intérêt d'utiliser R
Studio pour cette opération est que le fichier ainsi créé contient des
indications relatives à l'utilisation du fichier en question.


![Première étape, utilisez l'icône de création de nouveaux fichiers.](images/open_rmd.png)

![Seconde étape, choisissez le format de sortie désiré](images/open_rmd2.png)

![Un document contenant différentes instructions et examples est généré.](images/open_rmd3.png)




## Spécifier les documents à obtenir avec YAML

Le site officiel <https://yaml.org/> indique:

> [*Traduction*]
>
> YAML est un standard de sérialisation de données pour tous langages de programmation adopté à l'humain.


Autrement dit, dans un fichier au format YAML (extension `.yaml` ou `.yml`), on
entre des données qui pourront être utilisées dans par de nombreux langages de
programmation et ce fichier est facile à lire par l'humain. Pour que le contenu
du fichier soit effectivement utilisables dans un langage de programmation
donné, il faut que le code ad hoc soit disponible. Pour les utilisateurs de R,
c'est le package `yaml`[^ryaml] qui permet de lire de tels fichiers et de les
importer sous forme de listes.

<!-- predre qq examples simples et ajouter um fichier de lecture pour montere comment ça marche https://en.wikipedia.org/wiki/YAML -->


Pour comprendre l'essentiel du fonctionnement du YAML, je vous recommande le
tutoriel à l'URL suivante :
<https://sweetohm.net/article/introduction-yaml.html> en vous concentrant sur la
syntaxe et nous sur comment utiliser Python pour le faire. De manière générale:

```yaml
nomduchamp: données
```

et on saute une ligne pour ajouter un autre champ:

```yaml
nomduchamp: données
nomduchamp2: données2
```

Un champ données peut contenir une chaîne de caractère, une date, des chiffres ou encore une liste:

```yaml
nomduchamp: [élément1, élément2]
```

ou encore

```yaml
nomduchamp:
    - élément1
    - élément2
```

Noté que l'indentation est utilisée pour signifier la hiérarchie entre les différents éléments et que les commentaires sont introduits par un "\#".


```yaml
nomduchamp:
    souchamp1: élément1
# ce qui suit sont les élément dans le 2eme souschamp
    souchamp2:
        souchamp2a: élément2a
        souchamp2b:
            - élément2ba
              élément2ba
```


Aussi, voici un
exemple qui, bien que non-exhaustif, montre comment un fichier est structuré et
comment l'important dans R (le fichier utilisé est disponible dans le répertoire
GitHub <https://github.com/KevCaz/Rmarkdowndocfr/blob/master/aux/data_01.yaml>):


```yaml
author: Kevin Cazelles
date: 2020-06-06
description: "Il s'agit d'un exemple, utilisez les guillemets pour les longs textes avec ponctuation!"
# Les différents variables
var1: [C, C++, Dart, Julia, Python, R, Rust]
var2: y
var3:
   var3a:
      x: 1
      "y": 2
   var3b:
     - a
     - b
   var3c: |
      utiliser plusieurs
      lignes et garder les sauts de lignes
```

Pour l'importer avec le package `yaml`, j'utilise les commandes suivantes:


```{R yaml}
library(yaml)
yaml.load_file("aux/data_01.yaml")
```

Les chaînes de caractères `y`, `yes`, `true`, `TRUE` ainsi que `n`, `no`,
`false`, `FALSE` seront toutes interprétées comme variables booléennes
(respectivement `TRUE` ou `FALSE` dans R). C'est une fonctionnalité bien
pratique mais à double tranchant: par exemple si `y` est utilisé comme nom de
champ, le nom du champ sera interprété comme `TRUE` et pour palier ce
comportement, il faut ajouter des guillemets (voir l'exemple ci-dessus).


Les remarques précédentes sont générales et vous pourriez être amené à utiliser
YAML dans un autre contexte que l'édition de document avec R Markdown, par
exemple pour stocker des données. Revenons à l'utilisation de YAML dans un
document R Markdown. Ce qu'il faut bien garder à l'esprit, c'est que les options
utilisées servent à spécifier différents propriétés des documents à générer à
partir du fichier `.Rmd` (p-ex le titre, la date, les polices de caractères
utilisées, ajout d'une table des matières, etc.) grâce à des *templates*
utilisés par Pandoc. Ainsi, les options disponibles dépendent des templates
utilisés qui sont spécifiques à un format donné, les options par défaut varient
ainsi d'un format à l'autre. Pour un aperçu assez complet des options YAML
utilisables dans fichier R Markdown, rendez-vous à la dernière page du [guide de
référence](http://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf).
Notez qu'il est possible de créer ses propres templates et donc d'ajouter autant
d'options que désiré.


À titre d'exemple, ce document utilise un grand nombre d'options en voici une
reproduction quasi-identique (sans le résumé complet et sans la majorité des
commentaires que vous pouvez trouverez dans le fichier source de ce
document)&nbsp;:


```yaml
---
title: "Utiliser R Markdown pour créer des documents dynamiques"
date: "`r format(Sys.time(), '%d %B %Y')`"
author: par Kevin Cazelles
lang: fr
abstract: "Le package [...] pour aller plus loin."
fontfamily: fourier
linestretch: 1
fontsize: 10pt
lof: yes
output:
    html_document:
        toc: yes
        toc_float: yes
        highlight: default
        theme: flatly
        include:
            after_body: aux/footer.html
    PDF_document:
        highlight: tango
        toc: yes
        toc_depth: 3
        fig_caption: yes
        keep_tex: yes
        latex_engine: PDFlatex #xelatex
        number_section: yes
        includes:
            before_body: aux/license.tex
    word_document:
        #toc: yes
        fig_caption: yes
        highlight: pygments
    md_document:
        variant: markdown_strict
bibliography: aux/mybiblio.bib
csl: aux/journal-of-theoretical-biology.csl
header-includes:
    - \usepackage{fancyhdr}
    - \pagestyle{fancy}
    - \fancyfoot[CO,CE]{Documents dynamiques avec R Markdown}
    - \fancyfoot[R]{\thepage}
---
```

Comme expliqué précédemment, l’indentation est utilisée pour regrouper les
options par format. Ainsi, les lignes entre "pdf_document:" et "word_document:",
spécifient différent aspect relative à la génération au format PDF. Par exemple,
pour ajouter une table des matière, on ajoute `toc: yes`, "toc" signifiant
*table of content* (table des matières) et pour en contrôler la profondeur (le
niveau maximal de sous-titre affiché dans la table), on utilise "toc_depth".  De
même, "tof" (*table of figure*) permet d'ajouter une table des figures. Aussi,
l'option "number_section:true" permet d'obtenir une numérotation des différentes
parties.


<!-- https://hitchdev.com/strictyaml/ -->




## Éditer le contenu du fichier R Markdown

Pour cela, on utilise simplement du texte plein avec la syntaxe Pandoc Markdown
(détaillée dans la section suivante), la différence avec un document Markdown
est qu'il est possible d’exécuter du code R et d'utiliser les résultat du code,
ce qui rend le document dynamique (voir la section dédiée).



## Obtenir le document final (ou les documents finaux)

Une fois le fichier est prêt (ou qu'on souhaite voir le résultat) et que le
package `rmarkdown` est installé[^4], on utilise la fonction `render()` du
package en lui indiquant le chemin de du fichier `.Rmd`. Si on est un
utilisateur de RStudio, on peut cliquer sur `Knit` dans la barre de menu
contextuelle associée au fichier ( voir la documentation associée, `?render`).
Dans la suite du document, la function `render()` est utilisée:


```R
render("ex_Rmardown.rmd", "all")
```

L'argument "all" permet d’obtenir tous les fichiers pour lesquels il existe une spécification dans le fichier YAML. Les formats utilisés ici sont&nbsp;:

- [PDF](https://en.wikipedia.org/wiki/Portable_Document_Format)
- [HTML](http://rmarkdown.rstudio.com/html_document_format.html)
- [Word](http://rmarkdown.rstudio.com/word_document_format.html)

Les documents au format PDF requièrent [l'installation de
Latex](https://www.tug.org/texlive/quickinstall.html) étant donné que pour
produire un PDF à partir d'un fichier ".rmd", un premier fichier Latex est
produit. Pour le lecteur qui désire conserver le fichier Latex utilisé pour
produire le PDF, il suffit d'ajouter l'option "keep_tex: true" dans les options
relatives au format PDF dans le [Le fichier YAML][]. Pour le Markdown, un
fichier ".md" est généré suivant la variante de Markdown précisée dans le YAML
par "variant: markdown" (voir la section suivante). Le format "Tufte handout"
est une mise en page qui inclue des marges larges où sont insérées les
illustrations (dont les figures) et que nous devons au chercheur Edward Tufte.








# Le variante Pandoc de Markdown


Dans cette partie, je détaille les éléments de formatage du texte proposés par
la syntaxe Pandoc de Markdown. L’ensemble est très bien présenté sur le [site de
référence](http://rmarkdown.rstudio.com/authoring_pandoc_markdown.html)[^noteswmk]
et très bien résumé à la première page du [guide de
référence](http://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf).
Pour une source en français, j'ai trouvé un excellent tour d'horizon
nommé&nbsp;: "Élaboration et conversion de documents avec Markdown et Pandoc"
(<http://enacit1.epfl.ch/markdown-pandoc/>) écrit par Jean-Daniel Bonjour. Notez
que certains symboles sont réservés au formatage du texte. Cependant, quand leur
affichage est requis, on les fait précéder du caractère d'échappement qui est,
pour Markdown, l'antislash&nbsp;: "\\". Par exemple, j'entre&nbsp;:

    \\ \& \# \$ \[

Pour obtenir&nbsp;: \\ \& \# \$ \[. J'ajoute que certains sauts de ligne sont
obligatoires pour obtenir la mise en page désirée (pour les notes de bas de page
par exemple).


[^noteswmk]: Le site de documentation est totalement écrit en Markdown et reprend ce que nous pouvons lire sur le [site de Pandoc](http://pandoc.org/demo/example9/pandocs-markdown.html) et que je reprend mais en français!



## Décoration du texte

- Pour écrire du *texte en italique*, vous avez deux possibilités&nbsp;:

```md
*le texte à mettre en italique*
_le texte à mettre en italique_
```

- Pour écrire du **texte en gras**, encore deux possibilités&nbsp;:

```md
**le texte à mettre en gras**
__le texte à mettre en gras__
```

- Pour écrire du **_texte en gras et italique_**, utilisez&nbsp;:

```md
**le _texte en italique et en gras_**
```md

- Pour obtenir un ~~texte rayé~~, entrez&nbsp;:

```md
~~texte rayé~~
```

- Pour écrire un élément en ^exposant^, utilisez&nbsp;:

```md
^texte en exposant^
```

- Pour écrire un élément en ~indice~, tapez&nbsp;:

```md
~texte en indice~
```

Notez qu'il n'y a pas de balises pour le soulignement du texte. De manière
générale, quand un élément de mise en page manque dans la syntaxe, il est
toujours possible d'utiliser des commandes d'un langage. Par exemple, pour
souligner dans un document qui sera produit en HTML, je peux utiliser `<u>texte
souligné</u>` mais cela ne me permettra pas d'avoir un texte souligné en Word ou
en PDF. De même que si j'utilise `\underline{texte souligné}` le texte sera
souligné en PDF, mais pas en HTML ni en Word. Procéder de la sorte n'est pas
toujours souhaité car le document R Markdown perd en généralité, en ce sens où
il  ne pourra pas être correctement généré dans tous les formats. Cela n'est
cependant pas nécessairement un problème, par exemple, si vous souhaiter obtenir
le document en un seul format, ce fonctionnement devient un atout puisque vous
pouvez utiliser toute la gamme de mise en forme offert le langage en question.


## Les titres

Le plus simple est d’utiliser un nombre croissant de `#` (ATX heading) pour
descendre dans l'arborescence des titres:

```md
# Un titre d'ordre 1
## Un titre d'ordre 2
### Un titre d'ordre 3
```

Il est aussi possible d'utiliser une série de "=" en dessous des titre de
premier niveau et une ligne de "-" en dessous des titres de niveau 2. Cette
option a la qualité de permettre de repérer facilement les titres dans le code
source.


```md
Un titre d'ordre 1
==================
Un titre d'ordre 2
------------------
### Un titre d'ordre 3
```

## Les listes

Les listes sont très intuitives en Markdown, alors qu'elles requièrent des
balises un peu lourdes aussi bien en Latex qu'en HTML. Dans les exemples
donnés, il faut toujours séparer le texte principal de la liste par des sauts
de ligne. Aussi, il y a une différence de format


### Listes non numérotées

Pour obtenir une liste non numérotée j'entre&nbsp;:

```md
* objet 1,
* objet 2,
* objet 3.
```

ou bien&nbsp;:

```md
+ objet 1,
+ objet 2,
+ objet 3.
```

ou encore&nbsp;:

```md
- objet 1,
- objet 2,
- objet 3.
```

et même&nbsp;:

```md
+ objet 1,
* objet 2,
- objet 3.
```

Dans tous les cas, cela donne

+ objet 1,
+ objet 2,
+ objet 3.

Et si j'utilise on ajoute un espace entre les éléments de la liste alors le
rendu  change un peu, la liste est plus aérée, par exemple en HTML, une balise
paragraphe, `<p> </p>` est ajoutée, ainsi

```md
* objet 1,

* objet 2,

* objet 3.
```

devient:

* objet 1,

* objet 2,

* objet 3.


En utilisant une indentation de 4 espaces (ou une tabulation), on peut obtenir
des listes hiérarchisées, ainsi:


```md
- objet 1,
    + machin 1
        - chose 1
        - chose 2
    + machin 2
- objet 2,
- objet 3.
```

donne:

- objet 1,
    + machin 1
        - chose 1
        - chose 2
    + machin 2
- objet 2,
- objet 3.


En ajoutant au moins deux espaces à la fin des éléments d'une liste, chaque
élément de la liste est formaté comme un paragraphe &nbsp;:

- objet 1,
- objet 2,
- objet 3.


Pour alterner des listes avec du texte ou du code, il faut utiliser des sauts de
lignes avec l'indentation adéquate. Ainsi, avec les lignes suivantes&nbsp;:

```md
- élément 1&nbsp;:

    Un petit texte qui pourrait expliciter ce qu'est l'élément 1.

- machin 2:

          for (i in 1:2) print(i)
```


j'obtiens&nbsp;:


- élément 1&nbsp;:

    Un petit texte qui pourrait expliciter ce qu'est l'élément 1.

- machin 2:

      for (i in 1:2) print(i)



### Listes numérotées

Pour une liste numérotée, c'est aussi très simple, en entrant par exemple si je rentre&nbsp;:

```md
1. machin 1,
2. machin 2,
3. machin 3.
```

J'obtiens:

1. machin 1,
2. machin 2,
3. machin 3.

Si les nombres ne sont pas écrits manière ordonnée, cela ne changera pas le
résultat. Néanmoins, le premier nombre détermine le point de la liste. En
écrivant&nbsp;:

```md
3. machin 1,
3. machin 2,
3. machin 3,
5. machin 4.
```

j'obtiens&nbsp;:

3. machin 1,
3. machin 2,
3. machin 3,
5. machin 4.

Pour ne pas se soucier des numéros, il existe un style par défaut&nbsp;:

```md
#. machin 1,
#. machin 2,
#. machin 3.
```

on retrouve bien la première liste numérotée&nbsp;:

#. machin 1,
#. machin 2,
#. machin 3.

Plusieurs styles de numérotation sont disponibles, p. ex.&nbsp;:

```md
 #) élément 1
 #) élément 2
 #) élément 3
 (1) truc 1
 (2) truc 2
 (5) truc 3
       i. machin 1
       i. machin 2
       i. machin 3
```

nous donne&nbsp;:

#) élément 1
#) élément 2
#) élément 3
(1) truc 1
(2) truc 2
(5) truc 3
      i. machin 1
      i. machin 2
      i. machin 3


Nous avons aussi la possibilité de mélanger les niveaux numérotés et les niveaux
non-numérotés :

```md
1. machin 1,
    1. machin 1.1,
    2. machin 1.2,
2. machin 2,
    - machin 2.1,
    - machin 2.2,
    - machin 3,
3. machin 4,
4. machin 5.
```

ce qui donne&nbsp;:

1. machin 1,
    1. machin 1.1,
    2. machin 1.2,
2. machin 2,
    - machin 2.1,
    - machin 2.2,
- machin 3,
3. machin 4,
4. machin 5.

Enfin, il possible de mettre manuellement fin à une liste en introduisant un
commentaire entre les listes à séparer&nbsp;:

```md
	(1) truc 1
	(2) truc 2
	(3) truc 2b

	<!-- end -->

	(1) truc 3
	(2) truc 4
```

ces lignes sont rendues ainsi&nbsp;:

(1) truc 1
(2) truc 2
(3) truc 2b

<!-- end -->

(1) truc 3
(2) truc 4



## Blocs de citation

Pour utiliser un bloc de citation (la balise "blockquote" en HTML), il suffit
d'utiliser "\>" avant la citation. Ainsi les lignes suivantes&nbsp;:

```.md
> la citation est ajoutée comme ceci, elle nous donne une indentation adéquate
pour une mise en page agréable dont le style peut être facilement travailler
en HTML grâce au CSS.
```

deviennent&nbsp;:

> La citation est ajoutée comme ceci, elle nous donne une indentation adéquate pour une mise en page agréable dont le style peut être facilement travailler en HTML grâce au CSS.


Pour ajouter une hiérarchie dans les citations, on entre&nbsp;:

```.md
> La citation de départ
>
>> une hiérarchie dans la citation
```

ce qui donne&nbsp;:

> La citation de départ
>
>> une hiérarchie dans la citation


## Blocs de code

Pour l'ensemble des exemples qui suivent, que je présente sous forme de lignes
de code, j'utilise un environnement simple qui utilise une police d'écriture à
chasse fixe et affiche tous les caractères tels qu'ils sont entrés (les balises
ne sont pas interprétées).

Il est possible d'ajouter des morceaux de code colorés selon la nature des
éléments de la syntaxe d'un langage de programmation donné. Les morceaux de
codes peuvent être écrits entre série de tildes (\~) et une accolade est
nécessaire pour préciser le langage[^fenced]. Pour présenter un morceau de code
C, par exemple&nbsp;:


```md
~~~~~~~~~~~~~~~{.c}
// Commentaire
int c,d,g ;
c = 10;
d = 4;
int func(int a,int b) { return a*b; }
g = func(c,d)
printf("%i",g)
~~~~~~~~~~~~~~~
```

devient&nbsp;:

~~~~~~~~~~~{.c}
// Commentaire
int c,d,g;
c = 10;
d = 4;
int func(int a,int b) { return a*b; }
g = func(c,d);
printf("%i",g);
~~~~~~~~~~~


Plus simplement, on peut utiliser des blocs de trois apostrophes inversés
(*backquote* en anglais) et enlever l’accolade et le point pour préciser le
langage et ainsi, avec le code ci-dessous


    ```c
    // Commentaire
    int c,d,g ;
    c = 10;
    d = 4;
    int func(int a,int b) { return a*b; }
    g = func(c,d)
    printf("%i",g)
    ```

on obtient bien la même bloc de code que précédemment.


```c
// Commentaire
int c,d,g ;
c = 10;
d = 4;
int func(int a,int b) { return a*b; }
g = func(c,d)
printf("%i",g)
```

Dans le document, j'utilise justement ces blocs de code pour montrer comment
utiliser Markdown. Une autre façon simple pour faire un bloc de code est
d'ajouter simplement 4 espaces au début de chaque ligne. C'est d'ailleurs ce que
j'utilise quand je montre l'utilisation des apostrophes inversés ci-dessus!


Un des grands intérêts de R Markdown est d'avoir des blocs de codes R qui
peuvent être exécutés par R! Je détaille cette fonctionnalité plus bas.


[^fenced]: Voir la section *Fenced code blocks* du manuel de référence <https://pandoc.org/MANUAL.html>.



## Les barres horizontales

Une ligne barre horizontale peut être ajoutée comme suit&nbsp;:

    -------------

---------------

ou encore&nbsp;:

    *  *  *  *  *

*  *  *  *  *




## Mathématiques

### Symboles mathématiques

Pour utiliser les symboles mathématiques dans le texte, les commandes associées
doivent être placées entre deux "\$". Bien sur, il faut connaître les
combinaisons de caractère associées aux différents symboles. Ce sont les même
que celles proposées par [Latex](http://latex-project.org/intro.html) et qui
seront utilisées par [MathJax](http://www.mathjax.org) (par défaut) pour générer
les expressions mathématiques dans le fichier HTML. Pour quelques exemples,
[regarder ce site](http://www.suluclac.com/Wiki+MathJax+Syntax), pour quelque
choses de plus complet, jetez un œil
[ici](https://en.wikibooks.org/wiki/LaTeX/Mathematics). Voici tout de même
quelques exemples&nbsp;:

- quelques lettres grecques&nbsp;:

        $\alpha$, $\beta$, $\delta$, $\lambda$, $\pi$, $\phi$, $\omega$, $\varpi$, $\vartheta$

    pour obtenir&nbsp;: $\alpha$, $\beta$, $\delta$, $\lambda$, $\pi$, $\phi$, $\omega$, $\varpi$, $\vartheta$

- quelques symboles mathématiques&nbsp;:

        $\sum$, $\prod$, $\int$, $\infty$, $\lim$

    pour obtenir&nbsp;: $\sum$, $\prod$, $\int$, $\infty$, $\lim$

- quelques combinaisons&nbsp;:

        $\mu \in\mathbb{R}$, $\lim_{x \rightarrow 3} f(x)$

    pour obtenir&nbsp;: $\mu \in\mathbb{R}$, $\lim_{x \rightarrow 3} f(x)$



### Équations

Pour faire des équations, il faut placer l'équation entre double \$\$. Créons une première équation&nbsp;:

    $$\frac{vache}{oiseau} = \frac{2\pi}{l}$$

$$\frac{vache}{oiseau} = \frac{2\pi}{l}$$

Pour utiliser des équations numérotées, il faut ajouter "(\@label)" avant l'équation, je ré-utilise l'équation précédente&nbsp;:

    (@eq1) $$\frac{vache}{oiseau} = \frac{2\pi}{l}$$

(@eq1) $$\frac{vache}{oiseau} = \frac{2\pi}{l}$$

Je rajoute une seconde équation qui utilise les balises Latex pour créer un système :

    (@eq2) $$\begin{array}{ccc}
    x^2+y^2 &=& z^2 \\
    xy &=& z
    \end{array}$$

(@eq2) $$\begin{array}{ccc}
x^2+y^2 &=& z^2 \\
xy &=& z
\end{array}$$

La référence aux équations se fait en utilisant "(\@label)" dans le texte.
Ainsi, en écrivant "(\@eq1)", j'appelle l'équation (@eq1). De même je peux faire
référence à l'équation (@eq2) en utilisant "(\@eq2)"[^nbeq]. Les références
seront gérées correctement, mais le rendu visuel n'est pas nécessairement celui
désiré. Ils existent différentes solutions pour palier ceci. Pour les documents
HTML, il est possible d'utiliser le méchanisme de rendu HTML de bookdown (voir
https://bookdown.org/yihui/bookdown/markdown-extensions-by-bookdown.html), ce
qui revient à utiliser un autre type de format de sortie, mais qui reste du
HTML. Sinon, il est possible d'utiliser le filtre
[pandoc-eqnos](https://github.com/tomduck/pandoc-eqnos) (noter qu'il y a des
filtres équivalents pour les tables et les figures). Enfin, si vous voulez
simplement un PDF, vous pouvez travailler comme dans un document LaTeX (voir
https://www.overleaf.com/learn/latex/Cross%20referencing%20sections,%20equations%20and%20floats).

[^nbeq]: voir https://tex.stackexchange.com/questions/111868/pandoc-how-can-i-get-numbered-latex-equations-to-show-up-in-both-pdf-and-html-o)



## Les images

Pour insérer une image, deux solutions nous sont offertes&nbsp;:

1. la combinaison dite "inline"&nbsp;: \!+[nom de l'image (inclus dans la légende)]+(adresse)+{#label}. Par exemple,

        ![Le logo de R](./images/Rlogo.png)

![Le logo de R](./images/Rlogo.png)


2. la combinaison dite "reference"&nbsp;: \!+[nom de l'image (inclus dans la légende)]+[id] et ailleurs dans le document le détail [id]+\:+adresse. Par exemple

        [img2]: ./images/Markdown.png

        ![Le logo sur la page du Markdown original][img2]


Pour faire des références aux figures, comme pour les équations, vous pouvez
utiliser un filtre dédié,
[pandoc-fignos](https://github.com/tomduck/pandoc-fignos), ou, si vous souhaitez
simplement avoir les références dans un document PDF' vous pouvez peut injecter
une balise `\\label{lelabel}` et utiliser `\\ref{lelabel}`. Notez qu'avec R
Markdown, on peut très facilement inclure des graphiques produits avec R et meme
n'importe quelle image (voir plus bas).

## Les tables

La création facilitée de tableaux est l'une des extensions bien utile de Pandoc Markdown. Il existe plusieurs extensions pour faire des tableaux. Pour avoir des détails sur le sujet, je vous recommande la [page écrite par Jean-Daniel Bonjour](http://enacit1.epfl.ch/markdown-pandoc/#tableaux). Je présente ci-dessous un exemple de tableau de style "pipe table":

```md
    | Aligné à gauche | Aligné au centre | Par défaut | Aligné à droite
    | :-------  | :-------: | ------  | -------:
    | truc 1.1  | truc 2.1  | **_truc 3.1_** | truc 4.1
    | truc 1.2  | truc 2.2  | ~~truc 3.2~~   | truc 4.2
    | truc 1.3  | truc 2.3  | *truc 3.3*     | truc 4.1

    : La légende associé au tableau.
```

| Aligné à gauche | Aligné au centre | Par défaut | Aligné à droite
| :-------  | :-------: | ------  | -------:
| truc 1.1  | truc 2.1  | **_truc 3.1_** | truc 4.1
| truc 1.2  | truc 2.2  | ~~truc 3.2~~   | truc 4.2
| truc 1.3  | truc 2.3  | *truc 3.3*     | truc 4.1

: La légende associé au tableau.


Si vous préférez les obtenir grâce à une interface de type "WYSIWYG" (*What you
see is what you get*), vous pouvez utiliser [ce générateur de
table](http://www.tablesgenerator.com/markdown_tables). Pour les références, vos
avec les mêmes options que pour les figures et les équations, le filtre dédié
étant [pandoc-tablenos](https://github.com/tomduck/pandoc-tablenos). Notez
qu'avec R Markdown, vous pouvez facilement faire des tables à partir de data
frames. Je reviens sur là-dessus plus bas.



## Références

### Liens hypertextes

Les liens hypertextes sont utilisés sous la forme [groupe de mots sur lequel cliquer]+(adresse du lien). Pour créer un lien vers la page Markdown de Wikipedia, j'utilise&nbsp;:

    [Markdown](https://fr.wikipedia.org/wiki/Markdown)

et voila le lien vers la page [Markdown](https://fr.wikipedia.org/wiki/Markdown) de Wikipedia.



### Notes de bas de page

On peut produire une note de bas de page en plaçant la balise "[\^id]" là où la note doit être insérée. Pour préciser le texte qui y est associé, on utilise: "[\^id]\:texte associé" où l'on souhaite dans le document, il faut simplement que les notes de bas pages (rassemblées ou non) soit séparé du reste du texte par un saut de ligne. Personnellement, je préfère rassembler les notes d'une section à la fin de la section en question. Par exemple&nbsp;:

    Un bout de texte avec une note[^note1] et une autre [^note2].

    [^note1]: à la fin d'une section par exemple.
    [^note2]: ou encore, à la fin du document.

Un bout de texte avec une note[^note1] et une autre[^note2].

Notez qu'il faut séparer le texte des notes de bas de pages du texte principal d'un saut de ligne.


[^note1]: la première
[^note2]: la seconde



### Références à une section

La référence à une section se fait à l'aide de deux crochets. Dans le premier crochet, on trouve le texte associé au lien et dans le second, le nom de la partie à laquelle on fait référence&nbsp;:

    Référence à la [section sur les liens hypertextes][Liens hypertextes]

Référence à la [section sur les liens hypertextes][Liens hypertextes]

On peut également utiliser le nom de la section dans le premier crochet et rien dans le second&nbsp;:

    Rappelez vous la section [Liens hypertextes][]

Rappelez vous la section [Liens hypertextes][]



### Références bibliographiques

Un des points forts de Pandoc est la possibilité de gérer de manière très
efficace votre bibliographie grace au processeur de citation
[pandoc-citeproc](https://github.com/jgm/pandoc-citeproc). Un grand nombre de
fichiers de bibliographie sont bien gérés[^notebibli], dont les fichiers bibtex.
Pour plus de renseignements pour utiliser pandoc-citeproc dans un document  R
Markdown, visitez la [page du site de R Markdown
consacrée](http://rmarkdown.rstudio.com/authoring_bibliographies_and_citations.html).

L'exemple qui suit est basé sur le fichier bibtex (mybiblio.bib) disponible dans le dossier "aux" qui est donnée avec ce document et que je donne ci-dessous&nbsp;:

    @article{Lande1979,
        author = {Lande, R},
        journal = {Evolution (N. Y).},
        number = {1},
        pages = {402--416},
        title = {Quantitative Genetic Analysis of Multivariate Evolution,
        Applied   to    Brain : Body Size Allometry Russell Lande},
        volume = {33},
        year = {1979}
    }
    @article{Oreskes1994,
        author = {Oreskes, Naomi and Shrader-Frechette, Kristin and Belitz,   Kenneth},
        journal = {Science (80-. ).},
        number = {5147},
        pages = {641--646},
        title = {Verification, Validation, and Confirmation of Numerical
        Models in the Earth Sciences},
        volume = {263},
        year = {1994}
    }
    @article{Knauff2014,
        author = {Knauff, Markus and Nejasmic, Jelica},
        issn = {1932-6203},
        journal = {PLoS One},
        number = {12},
        pages = {e115069},
        title = {{An Efficiency Comparison of Document Preparation Systems
         Used in  Academic Research and Development}},
        volume = {9},
        year = {2014}
    }

Ce fichier est spécifié dans le YAML&nbsp;: "bibliography: mybiblio.bib" (voir la section "[Le fichier YAML][]"). Le style de citation peut être spécifié, entre autres, à l'aide d'un fichier CSL, lui aussi spécifié dans le YAML et fourni dans le dossier "aux" &nbsp;: "csl: ./aux/journal-of-theoretical-biology.csl". Dans le texte, on peut appeler une référence en utilisant la forme sans parenthèse ou avec parenthèse.
Pour la forme sans parenthèse, il suffit d'utiliser "\@id" où "id" est l'identifiant donné par le fichier "mybiblio.bib". Pour une référence sans parenthèse&nbsp;:

    1. Selon @Oreskes1994, la modélisation [...].

1. Selon @Oreskes1994, la modélisation [...].

Pour les citations entre parenthèses, les citations sont insérées entre crochets et séparées par des points-virgules&nbsp;:

    2. Dans la littérature [...] [@Oreskes1994] bien que  [...] [@Lande1979; @Knauff2014].

2. Dans la littérature [...] [@Oreskes1994] bien que [...] [@Lande1979; @Knauff2014].


On peut facilement ajouter du texte dans la parenthèse


    3. Dans la littérature, [...] [voir @Oreskes1994] bien que [...] [@Lande1979 entre autres].


3. Dans la littérature, [...] [voir @Oreskes1994] bien que [...] [@Lande1979 entre autres].


Il est important de savoir que la liste des références est mise à la fin du
document, nous ajoutons donc \#Références (ou \# bibliographie) à la fin du
document pour lui donner un titre. Une autre remarque pour vous dire qu'il
existe de nombreux fichiers "csl" (acronyme pour [*Citation Style
Langage*](https://en.wikipedia.org/wiki/Citation_Style_Language)) sur le [site
de Zotero](https://www.zotero.org/styles).


[^notebibli]: Les logiciels de gestion de bibliographie génèrent ces fichiers.








# Intégration de R dans le document

L'intérêt du package `rmarkdown` est d'étendre la syntaxe Pandoc Markdown avec
les fonctionnalités du [package
knitr](http://cran.r-project.org/web/packages/knitr/index.html) pour insérer du
code R ainsi que les sorties associées (sorties console et figures). Nous
obtenons ainsi un document dynamique en ce sens que si les données associées
et/ou le code R changent, le document évolue aussi.


## Les morceaux de code (*code chunks*)

### Deux injections de code possible

Il y a deux types de morceaux de code. En premier lieu, ceux qui sont insérés directement dans le texte ("inline"). Pour cela, il faut inclure le texte sous la forme&nbsp;: `` `r "\u0060r expression\u0060"` ``. Je peux, par exemple, demander l'heure et la date à R en utilisant la function *Sys.time()*&nbsp;: `r Sys.time()`.

Ensuite, il y a le code que nous souhaitons séparer du reste du texte et dont on
souhaite obtenir le résultat. Les morceaux de code sont alors écrits comme un
bloc de code, mais dans l'accolade on peut identifier le bloc de code et varier différent paramètres de rendu &nbsp;:

    `r ''````{r nomdublocdecode, param1=val1, param2=val2 ...}
    ligne de code 1
    ligne de code 2
    ...
    ligne de code n
    ```

la casse n'étant pas important pour le R de l'accolade, il est donc possible
d'utiliser

    `r ''````{R nomdublocdecode, param1=val1, param2=val2 ...}
    ligne de code 1
    ligne de code 2
    ...
    ligne de code n
    ```

Les commentaires sont introduits, comme dans R, sous la forme de lignes de
codes commençant par un `#`. Débutons avec un exemple simple qui inclut un
commentaire et une addition :

    `r ''````{r addition}
    # une addition avec R.
    2+3
    ```

Notez que "addition" qui suit "r" dans l'accolade est l'identifiant du morceau
de code, qui permet notamment de facilement identifié  Les lignes précédentes me donnent&nbsp;:

```{r addition}
# une addition avec R.
2+3
```

J'obtiens ainsi le code de R dans un environnement adéquate (voir la coloration
du code) avec la sortie console associée, en l'occurrence, le résultat de
l'addition. Je présente dans la suite un certain nombre d'options qui donne une
large flexibilité dans la création des morceaux de code.
Pour avoir accès à plus de précisions, reportez-vous au [guide de référence](http://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf) ou au [site de knitr](http://yihui.name/knitr/options/).
L'apparence des morceaux de code peut être facilement modifiée dans le YAML, avec le paramètre "highlight" (voir [plus haut][Le fichier YAML]) qui peut être spécifié pour les différents formats.


### Le paramètre "results"

Il est aussi possible de changer l'apparence des sorties console grâce au paramètre "results" dans l'accolade.

- result='asis' pour que les résultats soient affichées avec la police du document texte principal&nbsp;:

		`r ''```{r addition2, results='asis'}
		# une addition avec R.
		2+3
		```

```{r addition2, results='asis'}
# une addition avec R.
2+3
```

- result='hide'&nbsp;:

		`r ''```{r addition3, results='hide'}
		# une addition avec R.
		2+3
		```

```{r addition3, results='hide'}
# Commentaire : une addition avec R.
2+3
```

- Il existe aussi les options "results='hide'" et "results='hold'". La première n'affiche pas les sorties console de R (sauf les messages spéciaux comme les messages d'erreur). La seconde permet d'afficher l'ensemble des sorties après le morceau de code. Par exemple, sans cette option, en utilisant le code suivant'&nbsp;:

    `r ''```{r}
    a <- 2
    print(a)
    b <- 3
    print(b)
    2+3
    ```
j'obtiens&nbsp;:

```{r}
a <- 2
print(a)
b <- 3
print(b)
2+3
```

alors qu'en ajoutant "results='hold'"&nbsp;:

```{r, results='hold'}
a <- 2
print(a)
b <- b
print(b)
2+3
```

### Le paramètre "comment"

Les symboles devant les résultats de R peuvent être choisis en utilisant le paramètre "comment":

    `r ''```{r addition4, comment=">>", background='#FFFF00'}
    # Commentaire : une addition avec R.
    2+3
    ```

```{r addition4, comment=">>", background='#FFFF00'}
# une addition avec R.
2+3
```


### Les paramètres "eval" et "echo"

Nous pouvons être amené à présenter du code qu'il ne faut pas exécuter, il
existe pour cela le paramètre "eval". Ainsi, avec

    `r ''```{r, eval=FALSE}
    install.packages(`rmarkdown`)
    ```
l'installation du package `rmarkdown` n'est pas exécutée mais bien affichée&nbsp;:

```{r, eval=FALSE}
install.packages(`rmarkdown`)
```

Inversement, il est possible, grâce au paramètre "echo", de ne pas afficher un
code, mais ce qu'il génère, les lignes suivantes&nbsp;:

    `r ''```{r, echo=FALSE}
    cat("Mais quel code a été utilisé?")
    ```

deviennent&nbsp;:

```{r, echo=FALSE}
cat("Mais quel code a été utilisé?")
```

Encore une fois, je n'essaye pas d'être exhausti. Pour plus de précision, il y a le [guide de référence](http://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf) ou le [site de knitr](http://yihui.name/knitr/options/). Vous y apprendrez, entre autres, qu'il est possible de créer des dépendances entre morceaux de code, ce que je n'aborde pas dans le document.




## Les tableaux depuis R

QAvec le package `knitr`, il est possible d'intégrer dans le texte une table
créée sous R. Pour cela, il suffit de construire un objet R, le plus cohérent
est de créer un `data.frame` avec R (éventuellement à partir d'un fichier
importé), par exemple&nbsp;:


```{r dataframe1}
var1 <- 20*runif(15)
table1 <- data.frame(
    experience = paste0("exp",rep(1:3, each = 5)),
    replicat = rep(letters[1:5], 3),
    var1 = var1,
    var2 = var1 + rnorm(15)
    )
```

La fonction *kable()* du package "knitr" nous permet d'obtenir notre object
*table1* en différents formats (dont "latex", "html", "markdown").

```{r table1, results = ""}
knitr::kable(table1, caption="Table créée à partir du data.frame *table1*")
```

Pour en savoir plus, reportez-vous à la documentation de cette fonction. Le package [`kableExtra`](https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html) vaut aussi le coupe d'oeil!



## Les figures produites avec R

Avec le package `rmarkdown`, il est très facile d'insérer les figures produites
avec R dans un document, le plus simple est de regrader ce que nous génère
l'appel à un plot simple.

```{r}
plot(table1$var1,table1$var2)
```

J'obtiens la figure demandée qui est d'assez grande dimension et numérotée "Figure 3". Pour formater une figure obtenue avec R, il existe des options pour contrôler, entre autres, sa taille, son alignement et sa légende (taille et alignement ne sont pas supportés pour la sortie  Word). Pour visualiser l'ensemble des options disponibles, je vous invite à regarder la page 3 du [guide de référence](http://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf). Je vais changer la taille des figures, l'alignement et ajouter une légende

    `r ''```{r, fig.cap="une figure avec une légende",
    fig.height=4, fig.width=4,    fig.align='left'}
    plot(table1$var1,table1$var2)
    ```

```{r, fig.cap="une figure avec une légende", fig.height=4, fig.width=4,    fig.align='left'}
plot(table1$var1,table1$var2)
```

On peut alors profiter des facilités graphiques de R pour créer des figures
élégantes. Je peux, par exemple, personnaliser la figure précédente avec
quelques lignes supplémentaires.

```{r, fig.cap="Figure associé à la table 1 [...]. Le gris pour l'expérience 1, bleu pour la seconde et violet pour la troisième.\\label{figcol}", dpi=300, fig.heigh=4, fig.width=5}
par(bty="l", font=2)
plot(table1$var1,table1$var2, pch=15:19, col=rep(c(8,4,6),each=5), xlab="Mon axe des abscisses",
    ylab="Mon axe des ordonnées")
  legend("bottomright", letters[1:5], pch=15:19, bty="n")
```

J'ai ajouté à la fin de la légende "\\label{figcol}", je peux donc l'appeler en
utilisant "\\ref{figcol}" mai ce n'est valable que pour la sortie PDF. De mon
point de vue, on peut considérée qu'on a une extension graphique en ligne de
commande un peu moins verbeuse que
[PGF/TikZ](http://sourceforge.net/projects/pgf/).

```{r, fig.cap="Ma rosace", fig.height=6, fig.width=6}
kcircle <- function(rad=1,centre=c(0,0),from=0,to=2*pi,dt=0.001,...){
    pt <- seq(from, to, dt)
    polygon(centre[1]+rad*cos(pt),centre[2]+rad*sin(pt),...)
}
plot(c(-1.5,1.5), c(-1.5,1.5), asp=1, type="n", ann=FALSE,
    axes=FALSE, xaxs="i", yaxs="i")
kcircle(col="#AA000088")
for (i in 1:6) kcircle(1,c(cos(i*pi/3),sin(i*pi/3)), col="#0000AA88")
```


## Une  application, modèle linéaire dynamique

Je souhaite faire un modèle linéaire avec la variable explicative *var1* et la
variable à expliquer *var2* de notre *table1*. Nous créons alors un petit
document sachant que les données évolueront. Je vais faire une inclusion donc
utiliser du code R dans mon document.

```{r, fig.height = 6, fig.cap = "Mon modèle linéaire"}
mod1<-lm(var2~var1, data=table1)
summary(mod1)
par(bty="l", mfrow=c(2,2))
plot(mod1)
```







# Références



[^wiki_gruber]: <https://en.wikipedia.org/wiki/John_Gruber>, consulté le 1^er^ juin 2020.
[^wiki_rst]: <https://fr.wikipedia.org/wiki/ReStructuredText>, consulté le 1^er^ juin 2020.
[^blog_badparent]: <https://blog.codinghorror.com/responsible-open-source-code-parenting/>, consulté le 1^er^ juin 2020.
[^goldmark]: Par example Goldmark, <https://github.com/yuin/goldmard>, un parser Markdown écrit en Go et utilisé par Hugo (un générateur de site très populaire), est compatible avec Common Mark.
[^pmd]: <https://pandoc.org/MANUAL.html#pandocs-markdown>,  1^er^ juin 2020.
[^1]: La version 1 n'utilise pas Pandoc.
[^2]: Pandoc est d'ailleurs capable de gérer différentes variantes de Markdown.
[^template]: voir <https://pandoc.org/MANUAL.html#templates>, consulté le 1^er^ juin 2020.

[^notrad]: du contenu préliminaire.

[^wiki_TeX]: voir >https://fr.wikibooks.org/wiki/LaTeX/%C3%89crire_des_math%C3%A9matiques>, consulté le 2 juin 2020.
[^pm_math]: Voir la section "Math" à l'URL suivant >https://pandoc.org/MANUAL.html#pandocs-markdown>, consulté le 2 juin 2020.


[^ryaml]: <https://cran.r-project.org/web/packages/yaml/index.html>, consulté le 8 juin 2020.